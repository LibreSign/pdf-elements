(()=>{"use strict";var e={7938(e,t,i){var s=i(5471),n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-shell"},[t("AppToolbar",{attrs:{loading:e.loading,"is-ready":e.isReady,"is-adding-element":e.isAddingElement},on:{"load-sample":e.loadSample,"files-change":e.onFilesChange,"add-signature":e.startAddingSignature,"show-objects":e.showObjects,"clear-all":e.clearAll}}),t("DocumentsList",{attrs:{documents:e.fileNames},on:{remove:e.removeDocument}}),t("section",{staticClass:"viewer"},[t("PDFElements",{key:e.componentKey,ref:"pdf",attrs:{"init-files":e.initFiles,"init-file-names":e.fileNames,"initial-scale":1.1},on:{"pdf-elements:end-init":e.onReady},scopedSlots:e._u([{key:"element-signature",fn:function({object:i}){return[t("SignatureBox",{style:{fontSize:e.getResponsiveFontSize(i)},attrs:{object:i}})]}},{key:"custom",fn:function({object:i}){return[t("SignatureBox",{style:{fontSize:e.getResponsiveFontSize(i)},attrs:{object:i}})]}},{key:"actions",fn:function({onDelete:e}){return[t("DeleteButton",{on:{delete:e}})]}}])})],1),e.showElementsViewer&&e.pdf?t("ElementsViewer",{attrs:{"is-open":e.showElementsViewer,documents:e.pdf.pdfDocuments},on:{close:function(t){e.showElementsViewer=!1}}}):e._e()],1)},o=[],a=(i(8111),i(2489),i(1701),i(1100)),l=i(824),r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pdf-elements-root",style:{width:e.width,height:e.height}},[e.pdfDocuments.length?t("div",{staticClass:"pages-container",style:{transform:`scale(${e.visualScale/e.scale})`,transformOrigin:"top center"}},e._l(e.pdfDocuments,function(i,s){return t("div",{key:s},e._l(i.pages,function(n,o){return t("div",{key:`${s}-${o}`,staticClass:"page-slot"},[t("div",{staticClass:"page-wrapper",on:{mousedown:function(t){return e.selectPage(s,o)},touchstart:function(t){return e.selectPage(s,o)}}},[t("div",{staticClass:"page-canvas",class:{"shadow-outline":s===e.selectedDocIndex&&o===e.selectedPageIndex}},[t("PDFPage",{ref:`page${s}-${o}`,refInFor:!0,attrs:{page:n,scale:e.scale},on:{onMeasure:function(t){return e.onMeasure(t,s,o)}}}),t("div",{staticClass:"overlay"},[e.isAddingMode&&e.previewPageDocIndex===s&&e.previewPageIndex===o&&e.previewElement&&e.previewVisible?t("div",{staticClass:"preview-element",style:{left:e.previewPosition.x*e.previewScale.x+"px",top:e.previewPosition.y*e.previewScale.y+"px",width:e.previewElement.width*e.previewScale.x+"px",height:e.previewElement.height*e.previewScale.y+"px"}},[e._t("custom",null,{object:e.previewElement,isSelected:!1})],2):e._e(),e._l(i.allObjects[o],function(i){return t("DraggableElement",{key:i.id,ref:`draggable${s}-${o}-${i.id}`,refInFor:!0,attrs:{object:i,"pages-scale":e.getRenderPageScale(s,o),"page-width":e.getPageWidth(s,o),"page-height":e.getPageHeight(s,o),"on-update":t=>e.updateObject(s,i.id,t),"on-delete":()=>e.deleteObject(s,i.id),"on-drag-start":(t,n,a,l)=>e.startDraggingElement(s,o,i,t,n,a,l),"on-drag-move":e.updateDraggingPosition,"on-drag-end":e.stopDraggingElement,"is-being-dragged-globally":e.isDraggingElement&&e.draggingObject&&e.draggingObject.id===i.id,"dragging-client-pos":e.draggingClientPosition,"current-doc-index":s,"current-page-index":o,"global-drag-doc-index":e.draggingDocIndex,"global-drag-page-index":e.draggingPageIndex,"show-selection-ui":e.showSelectionHandles&&!e.hideSelectionUI&&!1!==i.resizable,"show-default-actions":e.showElementActions&&!e.hideSelectionUI},scopedSlots:e._u([{key:"default",fn:function(t){return[e._t(t.object.type?`element-${t.object.type}`:"custom",function(){return[e._t("custom",null,{object:t.object,onDelete:t.onDelete,onResize:t.onResize})]},{object:t.object,onDelete:t.onDelete,onResize:t.onResize})]}},{key:"actions",fn:function(t){return[e._t("actions",null,{object:t.object,onDelete:t.onDelete})]}}],null,!0)})})],2)],1),e.showPageFooter?t("div",{staticClass:"page-footer"},[t("span",[e._v(e._s(i.name))]),t("span",[e._v(e._s(e.formatPageNumber(o+1,i.numPages)))])]):e._e()])])}),0)}),0):e._e(),e.isDraggingElement&&e.draggingObject?t("div",{staticClass:"drag-portal",style:{position:"fixed",left:`${e.draggingClientPosition.x}px`,top:`${e.draggingClientPosition.y}px`,width:e.draggingObject.width*e.draggingScale+"px",height:e.draggingObject.height*e.draggingScale+"px",pointerEvents:"none"}},[e._t(e.draggingObject.type?`element-${e.draggingObject.type}`:"custom",function(){return[e._t("custom",null,{object:e.draggingObject,isSelected:!1})]},{object:e.draggingObject,isSelected:!1})],2):e._e()])},d=[],h=(i(4114),i(116),i(531),i(7588),i(6855)),c=function(){var e=this,t=e._self._c;return t("canvas",{ref:"canvas"})},g=[];const u={name:"PDFPage",props:{page:{type:Promise,required:!0},scale:{type:Number,default:1}},data(){return{dynamicScale:this.scale,isRendering:!1,boundMeasure:null}},watch:{scale(e){this.dynamicScale=e,this.render()}},mounted(){this.boundMeasure=this.measure.bind(this),window.addEventListener("resize",this.boundMeasure),this.render()},beforeUnmount(){this.boundMeasure&&window.removeEventListener("resize",this.boundMeasure)},methods:{getCanvasMeasurement(){return{canvasWidth:this.$refs.canvas.width,canvasHeight:this.$refs.canvas.height}},measure(){this.$emit("onMeasure",{scale:this.dynamicScale})},async render(){if(!this.isRendering){this.isRendering=!0;try{const e=await this.page,t=this.$refs.canvas,i=t.getContext("2d"),s=e.getViewport({scale:this.dynamicScale});t.width=s.width,t.height=s.height,await e.render({canvasContext:i,viewport:s}).promise,this.measure()}finally{this.isRendering=!1}}}}},f=u;var p=i(1656),m=(0,p.A)(f,c,g,!1,null,"2c9e224a",null);const v=m.exports;var b=function(){var e=this,t=e._self._c;return t("div",{staticClass:"draggable-wrapper"},[e.isSelected&&!e.isBeingDraggedGlobally&&e.showSelectionUi&&e.showDefaultActions?t("div",{staticClass:"actions-toolbar",style:e.toolbarStyle},[e._t("actions",function(){return[t("button",{staticClass:"action-btn",attrs:{type:"button",title:"Delete"},on:{click:function(t){return t.stopPropagation(),e.onDelete.apply(null,arguments)}}},[t("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor"}},[t("path",{attrs:{d:"M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.5a.5.5 0 0 0 0 1h.5v10.5A1.5 1.5 0 0 0 4.5 15h7a1.5 1.5 0 0 0 1.5-1.5V3.5h.5a.5.5 0 0 0 0-1H11Zm1 1v10.5a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5V3.5h8Z"}})])])]},{object:e.object,onDelete:e.onDelete})],2):e._e(),t("div",{staticClass:"draggable-element",class:{selected:e.isSelected&&e.showSelectionUi},style:[e.elementStyle,e.dragElementStyle],attrs:{draggable:"false"},on:{dragstart:function(e){e.preventDefault()},mousedown:e.handleElementClick,touchstart:e.handleElementClick}},[e._t("default",null,{object:e.object,isSelected:e.isSelected,onDelete:e.onDelete,onResize:e.startResizeFromSlot}),e.isSelected&&e.showSelectionUi?e._l(e.resizeDirections,function(i){return t("button",{key:i,staticClass:"resize-handle",class:`handle-${i}`,attrs:{type:"button"},on:{mousedown:function(t){return t.stopPropagation(),t.preventDefault(),e.startResize(i,t)},touchstart:function(t){return t.stopPropagation(),t.preventDefault(),e.startResize(i,t)}}})}):e._e()],2)])},y=[];const w={name:"DraggableElement",props:{object:{type:Object,required:!0},pagesScale:{type:Number,default:1},pageWidth:{type:Number,required:!0},pageHeight:{type:Number,required:!0},onUpdate:{type:Function,default:()=>{}},onDelete:{type:Function,default:()=>{}},onDragStart:{type:Function,default:()=>{}},onDragMove:{type:Function,default:()=>{}},onDragEnd:{type:Function,default:()=>{}},isBeingDraggedGlobally:{type:Boolean,default:!1},draggingClientPos:{type:Object,default:()=>({x:0,y:0})},currentDocIndex:{type:Number,default:-1},currentPageIndex:{type:Number,default:-1},globalDragDocIndex:{type:Number,default:-1},globalDragPageIndex:{type:Number,default:-1},showSelectionUi:{type:Boolean,default:!0},showDefaultActions:{type:Boolean,default:!0}},data(){return{isSelected:!1,mode:"idle",direction:"",startX:0,startY:0,startLeft:0,startTop:0,startWidth:0,startHeight:0,offsetX:0,offsetY:0,resizeOffsetX:0,resizeOffsetY:0,resizeOffsetW:0,resizeOffsetH:0,aspectRatio:1,lastMouseX:0,lastMouseY:0,pointerOffsetDoc:{x:0,y:0},currentPageRect:null,rafId:null}},computed:{resizeDirections(){return["top-left","top-right","bottom-left","bottom-right"]},elementStyle(){const e=this.pagesScale||1,t=this.object.x+this.offsetX+this.resizeOffsetX,i=this.object.y+this.offsetY+this.resizeOffsetY,s=this.object.width+this.resizeOffsetW,n=this.object.height+this.resizeOffsetH;return{left:t*e+"px",top:i*e+"px",width:s*e+"px",height:n*e+"px"}},toolbarStyle(){const e=this.pagesScale||1,t=this.object.x+this.offsetX+this.resizeOffsetX,i=this.object.y+this.offsetY+this.resizeOffsetY,s=this.object.width+this.resizeOffsetW;return{left:(t+s/2)*e+"px",top:(i-48)*e+"px",transform:"translateX(-50%)"}},dragElementStyle(){return this.isBeingDraggedGlobally&&this.draggingClientPos?{opacity:0,pointerEvents:"none"}:{}}},mounted(){this.handleClickOutside=this.handleClickOutside.bind(this),this.boundHandleMove=this.handleMove.bind(this),this.boundStopInteraction=this.stopInteraction.bind(this),document.addEventListener("mousedown",this.handleClickOutside),document.addEventListener("touchstart",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("mousedown",this.handleClickOutside),document.removeEventListener("touchstart",this.handleClickOutside),window.removeEventListener("mousemove",this.boundHandleMove),window.removeEventListener("mouseup",this.boundStopInteraction),window.removeEventListener("touchmove",this.boundHandleMove),window.removeEventListener("touchend",this.boundStopInteraction),this.rafId&&cancelAnimationFrame(this.rafId)},methods:{handleElementClick(e){e.target.closest(".delete-handle")||e.target.closest("[data-stop-drag]")||e.target.closest(".actions-toolbar")||(e.preventDefault(),this.isSelected=!0,this.startDrag(e))},handleClickOutside(e){this.$el&&!this.$el.contains(e.target)&&(this.isSelected=!1)},startResizeFromSlot(e,t){e&&t&&this.startResize(e,t)},startDrag(e){if(e.target.classList.contains("delete"))return;if(e.target.classList.contains("resize-handle"))return;this.mode="drag",this.startX=e.type.includes("touch")?e.touches[0].clientX:e.clientX,this.startY=e.type.includes("touch")?e.touches[0].clientY:e.clientY,this.startLeft=this.object.x,this.startTop=this.object.y,this.offsetX=0,this.offsetY=0,this.resetResizeOffsets();const t=this.$el.querySelector(".draggable-element").getBoundingClientRect();this.pointerOffsetDoc.x=this.startX-t.left,this.pointerOffsetDoc.y=this.startY-t.top;const i=this.capturePageRect();this.currentPageRect=i;let s={x:0,y:0};if(i){const e=i.left+this.object.x*this.pagesScale,n=i.top+this.object.y*this.pagesScale;s={x:t.left-e,y:t.top-n}}this.onDragStart(this.startX,this.startY,{...this.pointerOffsetDoc},s),window.addEventListener("mousemove",this.boundHandleMove),window.addEventListener("mouseup",this.boundStopInteraction),window.addEventListener("touchmove",this.boundHandleMove),window.addEventListener("touchend",this.boundStopInteraction)},startResize(e,t){this.mode="resize",this.direction=e,this.startX=t.type.includes("touch")?t.touches[0].clientX:t.clientX,this.startY=t.type.includes("touch")?t.touches[0].clientY:t.clientY,this.startLeft=this.object.x,this.startTop=this.object.y,this.startWidth=this.object.width,this.startHeight=this.object.height,this.aspectRatio=this.startWidth/this.startHeight,this.offsetX=0,this.offsetY=0,this.resetResizeOffsets(),window.addEventListener("mousemove",this.boundHandleMove),window.addEventListener("mouseup",this.boundStopInteraction),window.addEventListener("touchmove",this.boundHandleMove),window.addEventListener("touchend",this.boundStopInteraction)},handleMove(e){"idle"!==this.mode&&(e.preventDefault(),this.rafId||(this.rafId=requestAnimationFrame(()=>{const t=e.type.includes("touch")?e.touches[0]?.clientX:e.clientX,i=e.type.includes("touch")?e.touches[0]?.clientY:e.clientY;if(void 0===t||void 0===i)return;this.lastMouseX=t,this.lastMouseY=i;const s=(t-this.startX)/this.pagesScale,n=(i-this.startY)/this.pagesScale;if("drag"===this.mode){const e=this.currentPageRect;if(e){const s=t-this.pointerOffsetDoc.x,n=i-this.pointerOffsetDoc.y,o=(s-e.left)/this.pagesScale,a=(n-e.top)/this.pagesScale;this.offsetX=o-this.object.x,this.offsetY=a-this.object.y}else this.offsetX=s,this.offsetY=n;return this.onDragMove(t,i),this.isBeingDraggedGlobally&&this.onUpdate({_globalDrag:!0,_mouseX:t,_mouseY:i}),void(this.rafId=null)}const o=16;let a=this.startWidth,l=this.startHeight,r=this.startLeft,d=this.startTop;const h=this.direction.includes("right")?s:this.direction.includes("left")?-s:0;if(a=this.startWidth+h,a<o&&(a=o),l=a/this.aspectRatio,this.direction.includes("left")&&(r=this.startLeft+(this.startWidth-a),r<0)){const e=-r;r=0,a-=e,l=a/this.aspectRatio}if(this.direction.includes("top")&&(d=this.startTop+(this.startHeight-l),d<0)){const e=-d;d=0,l-=e,a=l*this.aspectRatio,this.direction.includes("left")&&(r=this.startLeft+(this.startWidth-a))}if(r+a>this.pageWidth){const e=r+a-this.pageWidth;a-=e,l=a/this.aspectRatio}if(d+l>this.pageHeight){const e=d+l-this.pageHeight;l-=e,a=l*this.aspectRatio,this.direction.includes("left")&&(r=this.startLeft+(this.startWidth-a))}this.resizeOffsetX=r-this.object.x,this.resizeOffsetY=d-this.object.y,this.resizeOffsetW=a-this.object.width,this.resizeOffsetH=l-this.object.height,this.rafId=null})))},stopInteraction(){if("idle"!==this.mode){if("drag"===this.mode&&(0!==this.offsetX||0!==this.offsetY))if(this.isBeingDraggedGlobally)this.onUpdate({_globalDrag:!0,_mouseX:this.lastMouseX,_mouseY:this.lastMouseY});else{const e=Math.max(0,Math.min(this.object.x+this.offsetX,this.pageWidth-this.object.width)),t=Math.max(0,Math.min(this.object.y+this.offsetY,this.pageHeight-this.object.height));this.onUpdate({x:e,y:t})}if("resize"===this.mode&&(0!==this.resizeOffsetW||0!==this.resizeOffsetH||0!==this.resizeOffsetX||0!==this.resizeOffsetY)){const e=this.object.x+this.resizeOffsetX,t=this.object.y+this.resizeOffsetY,i=this.object.width+this.resizeOffsetW,s=this.object.height+this.resizeOffsetH;this.onUpdate({x:e,y:t,width:i,height:s})}this.resetOffsets(),this.onDragEnd(),window.removeEventListener("mousemove",this.boundHandleMove),window.removeEventListener("mouseup",this.boundStopInteraction),window.removeEventListener("touchmove",this.boundHandleMove),window.removeEventListener("touchend",this.boundStopInteraction)}},capturePageRect(){const e=this.$el.closest(".page-wrapper");if(!e)return null;const t=e.querySelector("canvas");return t?t.getBoundingClientRect():null},resetResizeOffsets(){this.resizeOffsetX=0,this.resizeOffsetY=0,this.resizeOffsetW=0,this.resizeOffsetH=0},resetOffsets(){this.mode="idle",this.offsetX=0,this.offsetY=0,this.resetResizeOffsets(),this.pointerOffsetDoc={x:0,y:0},this.currentPageRect=null}}},x=w;var D=(0,p.A)(x,b,y,!1,null,"55db89ce",null);const P=D.exports;function S(e){return new Promise((t,i)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=i,s.readAsArrayBuffer(e)})}function O(e){return(0,a.YE)(e).promise}a.EA.workerSrc=l;const j={name:"PDFElements",components:{PDFPage:v,DraggableElement:P},props:{width:{type:String,default:"100%"},height:{type:String,default:"100%"},initFiles:{type:Array,default:()=>[]},initFileNames:{type:Array,default:()=>[]},initialScale:{type:Number,default:1},showPageFooter:{type:Boolean,default:!0},hideSelectionUI:{type:Boolean,default:!1},showSelectionHandles:{type:Boolean,default:!0},showElementActions:{type:Boolean,default:!0},pageCountFormat:{type:String,default:"{currentPage} of {totalPages}"},autoFitZoom:{type:Boolean,default:!1}},data(){return{scale:this.initialScale,pdfDocuments:[],selectedDocIndex:-1,selectedPageIndex:-1,isAddingMode:!1,previewElement:null,previewPosition:{x:0,y:0},previewScale:{x:1,y:1},previewPageDocIndex:-1,previewPageIndex:-1,previewVisible:!1,pagesBoundingRects:{},isDraggingElement:!1,draggingObject:null,draggingDocIndex:-1,draggingPageIndex:-1,draggingClientPosition:{x:0,y:0},draggingScale:1,draggingInitialMouseOffset:{x:0,y:0},draggingElementShift:{x:0,y:0},lastMouseClientPos:{x:0,y:0},viewportRafId:0,objectIndexCache:{},zoomRafId:null,boundHandleWheel:null,debouncedApplyZoom:null,visualScale:this.initialScale,resizeObserver:null}},mounted(){this.boundHandleWheel=this.handleWheel.bind(this),this.debouncedApplyZoom=(0,h.A)(this.commitZoom,150),this.init(),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("touchmove",this.handleMouseMove,{passive:!0}),document.addEventListener("mouseup",this.finishAdding),document.addEventListener("touchend",this.finishAdding),document.addEventListener("keydown",this.handleKeyDown),window.addEventListener("scroll",this.onViewportScroll,{passive:!0}),window.addEventListener("resize",this.onViewportScroll),this.$el?.addEventListener("scroll",this.onViewportScroll,{passive:!0}),this.$el?.addEventListener("wheel",this.boundHandleWheel,{passive:!1}),this.autoFitZoom&&(window.addEventListener("resize",this.adjustZoomToFit),"undefined"!==typeof ResizeObserver&&(this.resizeObserver=new ResizeObserver(()=>{this.scheduleAutoFitZoom()}),this.$el&&this.resizeObserver.observe(this.$el)))},beforeUnmount(){this.zoomRafId&&cancelAnimationFrame(this.zoomRafId),this.debouncedApplyZoom?.clear?.(),this.boundHandleWheel&&this.$el?.removeEventListener("wheel",this.boundHandleWheel),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("touchmove",this.handleMouseMove),document.removeEventListener("mouseup",this.finishAdding),document.removeEventListener("touchend",this.finishAdding),document.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("scroll",this.onViewportScroll),window.removeEventListener("resize",this.onViewportScroll),this.$el?.removeEventListener("scroll",this.onViewportScroll),this.autoFitZoom&&(window.removeEventListener("resize",this.adjustZoomToFit),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)),this.viewportRafId&&(window.cancelAnimationFrame(this.viewportRafId),this.viewportRafId=0)},methods:{async init(){if(!this.initFiles||0===this.initFiles.length)return;const e=[];for(let t=0;t<this.initFiles.length;t++){const i=this.initFiles[t],s=this.initFileNames[t]||`document-${t+1}.pdf`;let n;if(i instanceof Blob){const e=await S(i);n=await O({data:e})}else n=await O(i);const o=[],a=Array(n.numPages).fill(0);for(let e=1;e<=n.numPages;e++){const t=n.getPage(e);t.then(t=>{a[e-1]=t.getViewport({scale:1}).width,this.autoFitZoom&&this.scheduleAutoFitZoom()}),o.push(t)}e.push({name:s,file:i,pdfDoc:n,numPages:n.numPages,pages:o,pageWidths:a,pagesScale:Array(n.numPages).fill(this.scale),allObjects:Array(n.numPages).fill(0).map(()=>[])})}this.pdfDocuments=e,e.length&&(this.selectedDocIndex=0,this.selectedPageIndex=0,this.$emit("pdf-elements:end-init",{docsCount:e.length}),this.$nextTick(()=>{this.autoFitZoom&&this.scheduleAutoFitZoom()}))},selectPage(e,t){this.selectedDocIndex=e,this.selectedPageIndex=t},startDraggingElement(e,t,i,s,n,o,a){this.isDraggingElement=!0,this.draggingObject={...i},this.draggingDocIndex=e,this.draggingPageIndex=t,this.draggingScale=this.getDisplayedPageScale(e,t),this.lastMouseClientPos.x=s,this.lastMouseClientPos.y=n,this.draggingElementShift=a&&"number"===typeof a.x&&"number"===typeof a.y?a:{x:0,y:0};const l=`${e}-${t}`;this.pagesBoundingRects[l]||this.cachePageBounds();const r=this.pagesBoundingRects[l]?.rect;if(o&&"number"===typeof o.x&&"number"===typeof o.y)this.draggingInitialMouseOffset.x=o.x,this.draggingInitialMouseOffset.y=o.y,this.draggingClientPosition.x=s-this.draggingInitialMouseOffset.x,this.draggingClientPosition.y=n-this.draggingInitialMouseOffset.y;else if(r){const e=r.left+i.x*this.draggingScale,t=r.top+i.y*this.draggingScale;this.draggingInitialMouseOffset.x=s-e,this.draggingInitialMouseOffset.y=n-t,this.draggingClientPosition.x=s-this.draggingInitialMouseOffset.x,this.draggingClientPosition.y=n-this.draggingInitialMouseOffset.y}this.cachePageBounds()},updateDraggingPosition(e,t){this.isDraggingElement&&(this.lastMouseClientPos.x=e,this.lastMouseClientPos.y=t,this.draggingClientPosition.x=e-this.draggingInitialMouseOffset.x,this.draggingClientPosition.y=t-this.draggingInitialMouseOffset.y)},stopDraggingElement(){if(this.draggingObject){const e=this.draggingObject.id,t=this.draggingDocIndex,i=this.checkAndMoveObjectPage(this.draggingDocIndex,e,this.lastMouseClientPos.x,this.lastMouseClientPos.y);void 0!==i&&this.$nextTick(()=>{this.selectPage(t,i);const s=`draggable${t}-${i}-${e}`,n=this.$refs[s];n&&Array.isArray(n)&&n[0]&&(n[0].isSelected=!0)})}this.isDraggingElement=!1,this.draggingObject=null,this.draggingDocIndex=-1,this.draggingPageIndex=-1,this.draggingElementShift={x:0,y:0}},startAddingElement(e){this.pdfDocuments.length&&(this.isAddingMode=!0,this.previewElement={...e},this.previewPageDocIndex=0,this.previewPageIndex=0,this.previewVisible=!1,this.previewScale={x:1,y:1},this.cachePageBounds())},cachePageBounds(){this.pagesBoundingRects={};for(let e=0;e<this.pdfDocuments.length;e++)for(let t=0;t<this.pdfDocuments[e].pages.length;t++){const i=this.getPageCanvasElement(e,t);if(!i)continue;const s=i.getBoundingClientRect();this.pagesBoundingRects[`${e}-${t}`]={docIndex:e,pageIndex:t,rect:s}}},getDisplayedPageScale(e,t){const i=this.pdfDocuments[e];if(!i)return 1;const s=i.pagesScale[t]||1,n=this.visualScale&&this.scale?this.visualScale/this.scale:1;return s*n},getRenderPageScale(e,t){const i=this.pdfDocuments[e];return i&&i.pagesScale[t]||1},getPageComponent(e,t){const i=this.$refs[`page${e}-${t}`];return i&&Array.isArray(i)&&i[0]?i[0]:null},getPageCanvasElement(e,t){const i=this.getPageComponent(e,t);return i?i.$el||i:null},onViewportScroll(){this.viewportRafId||(this.viewportRafId=window.requestAnimationFrame(()=>{(this.isAddingMode||this.isDraggingElement)&&this.cachePageBounds(),this.viewportRafId=0}))},handleMouseMove(e){if(!this.isAddingMode||!this.previewElement)return;const t=e.type.includes("touch")?e.touches[0].clientX:e.clientX,i=e.type.includes("touch")?e.touches[0].clientY:e.clientY;let s=!1;for(const n in this.pagesBoundingRects){const{docIndex:e,pageIndex:o,rect:a}=this.pagesBoundingRects[n];if(t>=a.left&&t<=a.right&&i>=a.top&&i<=a.bottom){this.previewPageDocIndex=e,this.previewPageIndex=o,s=!0;const n=this.getPageCanvasElement(e,o),l=this.pdfDocuments[e]?.pagesScale?.[o]||1,r=n?.offsetWidth||a.width,d=n?.offsetHeight||a.height,h=r?a.width/r:1,c=d?a.height/d:1,g=(t-a.left)/h/l,u=(i-a.top)/c/l,f=r/l,p=d/l;this.previewScale.x=l*h,this.previewScale.y=l*c;let m=g-this.previewElement.width/2,v=u-this.previewElement.height/2;m=Math.max(0,Math.min(m,f-this.previewElement.width)),v=Math.max(0,Math.min(v,p-this.previewElement.height)),this.previewPosition.x=m,this.previewPosition.y=v,this.previewVisible=!0;break}}s||(this.previewVisible=!1,this.previewScale={x:1,y:1})},handleKeyDown(e){"Escape"===e.key&&this.isAddingMode&&this.cancelAdding()},handleWheel(e){if(!e.ctrlKey)return;e.preventDefault();const t=1-.002*e.deltaY,i=Math.max(.5,Math.min(3,this.visualScale*t));this.visualScale=i,this.debouncedApplyZoom()},commitZoom(){const e=this.visualScale;this.scale=e,this.pdfDocuments.forEach(e=>{e.pagesScale=e.pagesScale.map(()=>this.scale)}),this.cachePageBounds()},finishAdding(){if(!this.isAddingMode||!this.previewElement)return;if(!this.previewVisible)return;const e={...this.previewElement,id:`obj-${Date.now()}`,x:Math.round(this.previewPosition.x),y:Math.round(this.previewPosition.y)},t=this.pdfDocuments[this.previewPageDocIndex],i=this.getPageWidth(this.previewPageDocIndex,this.previewPageIndex),s=this.getPageHeight(this.previewPageDocIndex,this.previewPageIndex);if(e.x<0||e.y<0||e.x+e.width>i||e.y+e.height>s)return void this.cancelAdding();t.allObjects[this.previewPageIndex].push(e);const n=this.previewPageIndex,o=this.previewPageDocIndex,a=e.id;this.cancelAdding(),this.$nextTick(()=>{const e=`draggable${o}-${n}-${a}`,t=this.$refs[e];t&&Array.isArray(t)&&t[0]&&(t[0].isSelected=!0)})},cancelAdding(){this.isAddingMode=!1,this.previewElement=null,this.previewVisible=!1},addObjectToPage(e,t=this.selectedPageIndex,i=this.selectedDocIndex){if(i<0||i>=this.pdfDocuments.length)return!1;if(t<0||t>=this.pdfDocuments[i].pages.length)return!1;const s=this.pdfDocuments[i],n=this.getPageComponent(i,t);if(!n)return!1;const o=this.getPageWidth(i,t),a=this.getPageHeight(i,t);return!(e.x<0||e.y<0||e.x+e.width>o||e.y+e.height>a)&&(s.allObjects=s.allObjects.map((i,s)=>s===t?[...i,e]:i),!0)},getAllObjects(e=this.selectedDocIndex){if(e<0||e>=this.pdfDocuments.length)return[];const t=this.pdfDocuments[e],i=this.scale||1,s=[];return t.allObjects.forEach((t,n)=>{const o=this.getPageComponent(e,n);if(!o)return;const a=o.getCanvasMeasurement(),l=a.canvasHeight/i;t.forEach(e=>{s.push({...e,pageIndex:n,pageNumber:n+1,scale:i,normalizedCoordinates:{llx:parseInt(e.x,10),lly:parseInt(l-e.y,10),ury:parseInt(l-e.y-e.height,10)}})})}),s},updateObject(e,t,i){if(e<0||e>=this.pdfDocuments.length)return;const s=this.pdfDocuments[e],n=`${e}-${t}`;let o=this.objectIndexCache[n];if(void 0===o&&s.allObjects.forEach((e,i)=>{e.find(e=>e.id===t)&&(o=i,this.objectIndexCache[n]=i)}),void 0===o)return;const a=s.allObjects[o]?.find(e=>e.id===t);if(a){if(i._globalDrag&&void 0!==i._mouseX&&void 0!==i._mouseY){const n=i._mouseX,a=i._mouseY;this.pagesBoundingRects&&0!==Object.keys(this.pagesBoundingRects).length||this.cachePageBounds();const l=this.pagesBoundingRects[`${e}-${o}`]?.rect;if(l){const i=this.getDisplayedPageScale(e,o),r=(n-l.left-this.draggingElementShift.x)/i-this.draggingInitialMouseOffset.x/i,d=(a-l.top-this.draggingElementShift.y)/i-this.draggingInitialMouseOffset.y/i;s.allObjects[o]=s.allObjects[o].map(e=>e.id===t?{...e,x:r,y:d}:e)}return}if(void 0!==i.x||void 0!==i.y){const n=void 0!==i.x?i.x:a.x,l=void 0!==i.y?i.y:a.y,r=void 0!==i.width?i.width:a.width,d=void 0!==i.height?i.height:a.height;let h=o,c=0;for(let t=0;t<s.pages.length;t++){const i=this.getPageWidth(e,t),s=this.getPageHeight(e,t),o=Math.max(0,n),a=Math.max(0,l),g=Math.min(i,n+r),u=Math.min(s,l+d);if(g>o&&u>a){const e=(g-o)*(u-a);e>c&&(c=e,h=t)}}if(h!==o){const c=this.getPageWidth(e,h),g=this.getPageHeight(e,h),u=Math.max(0,Math.min(n,c-r)),f=Math.max(0,Math.min(l,g-d));s.allObjects[o]=s.allObjects[o].filter(e=>e.id!==t);const p={...a,...i,x:u,y:f};return s.allObjects[h].push(p),void(this.objectIndexCache[`${e}-${t}`]=h)}const g=this.getPageWidth(e,o),u=this.getPageHeight(e,o);if(n<0||l<0||n+r>g||l+d>u)return}s.allObjects=s.allObjects.map(e=>e.map(e=>e.id===t?{...e,...i}:e))}},deleteObject(e,t){if(e<0||e>=this.pdfDocuments.length)return;const i=this.pdfDocuments[e];i.allObjects=i.allObjects.map(e=>e.filter(e=>e.id!==t)),delete this.objectIndexCache[`${e}-${t}`]},checkAndMoveObjectPage(e,t,i,s){if(e<0||e>=this.pdfDocuments.length)return;const n=this.pdfDocuments[e],o=`${e}-${t}`;let a=this.objectIndexCache[o];if(void 0===a&&n.allObjects.forEach((e,i)=>{e.find(e=>e.id===t)&&(a=i,this.objectIndexCache[o]=i)}),void 0===a)return;const l=n.allObjects[a]?.find(e=>e.id===t);if(!l)return a;let r=a;for(const v in this.pagesBoundingRects){const{docIndex:t,pageIndex:n,rect:o}=this.pagesBoundingRects[v];if(t===e&&i>=o.left&&i<=o.right&&s>=o.top&&s<=o.bottom){r=n;break}}const d=this.pagesBoundingRects[`${e}-${r}`]?.rect;if(!d)return a;const h=this.getDisplayedPageScale(e,r),c=(i-d.left-this.draggingElementShift.x)/h-this.draggingInitialMouseOffset.x/h,g=(s-d.top-this.draggingElementShift.y)/h-this.draggingInitialMouseOffset.y/h,u=this.getPageWidth(e,r),f=this.getPageHeight(e,r),p=Math.max(0,Math.min(c,u-l.width)),m=Math.max(0,Math.min(g,f-l.height));return r!==a?(n.allObjects[a]=n.allObjects[a].filter(e=>e.id!==t),n.allObjects[r].push({...l,x:p,y:m}),this.objectIndexCache[o]=r):p===l.x&&m===l.y||(n.allObjects[a]=n.allObjects[a].map(e=>e.id===t?{...e,x:p,y:m}:e)),r},onMeasure(e,t,i){t<0||t>=this.pdfDocuments.length||(this.pdfDocuments[t].pagesScale[i]=e.scale,this.cachePageBounds(),this.autoFitZoom&&this.scheduleAutoFitZoom())},formatPageNumber(e,t){return this.pageCountFormat.replace("{currentPage}",e).replace("{totalPages}",t)},getPageWidth(e,t){const i=this.getPageComponent(e,t);if(!i)return 0;const s=this.pdfDocuments[e],n=s.pagesScale[t]||1;return i.getCanvasMeasurement().canvasWidth/n},getPageHeight(e,t){const i=this.getPageComponent(e,t);if(!i)return 0;const s=this.pdfDocuments[e],n=s.pagesScale[t]||1;return i.getCanvasMeasurement().canvasHeight/n},calculateOptimalScale(e){const t=this.$el?.clientWidth||0;if(!t||!e)return 1;const i=t-40;return Math.max(.1,Math.min(2,i/e))},scheduleAutoFitZoom(){this.zoomRafId||(this.zoomRafId=window.requestAnimationFrame(()=>{this.zoomRafId=0,this.adjustZoomToFit()}))},adjustZoomToFit(){if(!this.autoFitZoom||!this.pdfDocuments.length)return;const e=this.pdfDocuments.flatMap(e=>e.pageWidths||[]).filter(e=>e>0);let t=0;if(e.length)t=Math.max(...e);else{if(this.autoFitZoom)return void this.scheduleAutoFitZoom();const e=this.$el?.querySelectorAll("canvas");if(!e?.length)return;t=Math.max(...Array.from(e).map(e=>e.width/(this.scale||1)))}const i=this.calculateOptimalScale(t);Math.abs(i-this.scale)>.01&&(this.scale=i,this.visualScale=i,this.pdfDocuments.forEach(e=>{e.pagesScale=e.pagesScale.map(()=>this.scale)}),this.cachePageBounds())}}},E=j;var C=(0,p.A)(E,r,d,!1,null,"ddd8aa14",null);const M=C.exports;a.EA.workerSrc=l,M.install=function(e){M.install.installed||e.component(M.name,M)},"undefined"!==typeof window&&window.Vue&&M.install(window.Vue);const _=M;var I=function(){var e=this,t=e._self._c;return t("header",{staticClass:"toolbar"},[t("div",{staticClass:"actions"},[t("button",{staticClass:"btn",attrs:{disabled:e.loading},on:{click:function(t){return e.$emit("load-sample")}}},[e._v(" Load sample PDF ")]),t("label",{staticClass:"btn file-btn",class:{disabled:e.loading}},[t("input",{attrs:{type:"file",accept:"application/pdf",multiple:"",disabled:e.loading},on:{change:function(t){return e.$emit("files-change",t)}}}),e._v(" Add PDFs ")]),t("button",{staticClass:"btn",attrs:{disabled:!e.isReady||e.isAddingElement},on:{click:function(t){return e.$emit("add-signature")}}},[e._v(" "+e._s(e.isAddingElement?"Click to place":"Add Signature")+" ")]),t("button",{staticClass:"btn ghost",attrs:{disabled:!e.isReady},on:{click:function(t){return e.$emit("show-objects")}}},[e._v(" List objects ")]),t("button",{staticClass:"btn ghost",attrs:{disabled:!e.isReady},on:{click:function(t){return e.$emit("clear-all")}}},[e._v(" Clear all ")])]),t("p",{staticClass:"hint"},[e._v(' Click "Add Signature" then move mouse over PDF pages to preview position. Click to place on a page or press ESC to cancel. ')])])},A=[];const R={name:"AppToolbar",props:{loading:{type:Boolean,default:!1},isReady:{type:Boolean,default:!1},isAddingElement:{type:Boolean,default:!1}}},z=R;var $=(0,p.A)(z,I,A,!1,null,"bf48ab7e",null);const F=$.exports;var L=function(){var e=this,t=e._self._c;return e.documents.length?t("section",{staticClass:"docs-list"},[t("h3",[e._v("Documents ("+e._s(e.documents.length)+")")]),t("ul",e._l(e.documents,function(i,s){return t("li",{key:s},[e._v(" "+e._s(i)+" "),t("button",{staticClass:"remove-doc",attrs:{title:"Remove"},on:{click:function(t){return e.$emit("remove",s)}}},[e._v("×")])])}),0)]):e._e()},k=[];const B={name:"DocumentsList",props:{documents:{type:Array,default:()=>[]}}},H=B;var W=(0,p.A)(H,L,k,!1,null,"3497c0c2",null);const Y=W.exports;var X=function(){var e=this,t=e._self._c;return t("div",{staticClass:"signature-box"},["signature"===e.object.icon?t("svg",{staticClass:"icon",attrs:{width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"currentColor"}},[t("path",{attrs:{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}})]):e._e(),t("span",{staticClass:"label"},[e._v(e._s(e.object.label))])])},V=[];const Z={name:"SignatureBox",props:{object:{type:Object,required:!0},fontSize:{type:String,default:"14px"}}},N=Z;var T=(0,p.A)(N,X,V,!1,null,"aa72d0a2",null);const U=T.exports;var q=function(){var e=this,t=e._self._c;return t("button",{staticClass:"delete-btn",attrs:{type:"button",title:"Delete"},on:{click:function(t){return t.stopPropagation(),e.$emit("delete")}}},[t("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor"}},[t("path",{attrs:{d:"M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.5a.5.5 0 0 0 0 1h.5v10.5A1.5 1.5 0 0 0 4.5 15h7a1.5 1.5 0 0 0 1.5-1.5V3.5h.5a.5.5 0 0 0 0-1H11Zm1 1v10.5a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5V3.5h8Z"}})])])},K=[];const G={name:"DeleteButton"},J=G;var Q=(0,p.A)(J,q,K,!1,null,"47ad8434",null);const ee=Q.exports;var te=function(){var e=this,t=e._self._c;return e.isOpen?t("div",{staticClass:"modal-overlay",on:{click:e.close}},[t("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h2",[e._v("Elements Details")]),t("button",{staticClass:"close-btn",on:{click:e.close}},[e._v("×")])]),0===e.elements.length?t("div",{staticClass:"empty-state"},[t("p",[e._v("No elements added yet.")]),t("p",[e._v('Click "Add Signature" to add elements to your PDF.')])]):t("div",{staticClass:"elements-list"},[t("table",[e._m(0),t("tbody",e._l(e.elements,function(i){return t("tr",{key:i.id,staticClass:"element-row"},[t("td",{staticClass:"doc-name"},[e._v(e._s(i.docName))]),t("td",{staticClass:"page-num"},[e._v(e._s(i.pageNum))]),t("td",{staticClass:"type-badge"},[t("span",{class:`badge badge-${i.type}`},[e._v(e._s(i.type||"custom"))])]),t("td",{staticClass:"label"},[e._v(e._s(i.label||"—"))]),t("td",{staticClass:"id",attrs:{title:i.id}},[e._v(e._s(i.id.substring(0,12))+"…")]),t("td",{staticClass:"position"},[e._v(e._s(i.x)+", "+e._s(i.y))]),t("td",{staticClass:"size"},[e._v(e._s(i.width)+"×"+e._s(i.height))])])}),0)])]),t("div",{staticClass:"modal-footer"},[e._m(1),t("button",{staticClass:"btn",on:{click:e.close}},[e._v("Close")])])])]):e._e()},ie=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Document")]),t("th",[e._v("Page")]),t("th",[e._v("Type")]),t("th",[e._v("Label")]),t("th",[e._v("ID")]),t("th",[e._v("Position")]),t("th",[e._v("Size")])])])},function(){var e=this,t=e._self._c;return t("p",{staticClass:"info-text"},[t("strong",[e._v("How to integrate:")]),e._v(" Call "),t("code",[e._v("pdf.getAllObjects()")]),e._v(" to get all elements or access individual document data via "),t("code",[e._v("pdf.pdfDocuments")])])}];const se={name:"ElementsViewer",props:{isOpen:{type:Boolean,default:!1},documents:{type:Array,default:()=>[]}},computed:{elements(){const e=[];for(let t=0;t<this.documents.length;t++){const i=this.documents[t];if(i.allObjects)for(let s=0;s<i.allObjects.length;s++){const n=i.allObjects[s];for(const o of n)e.push({docName:i.name||`Document ${t+1}`,pageNum:s+1,type:o.type||"custom",label:o.label||"",id:o.id,x:Math.round(o.x),y:Math.round(o.y),width:Math.round(o.width),height:Math.round(o.height)})}}return e}},methods:{close(){this.$emit("close")}}},ne=se;var oe=(0,p.A)(ne,te,ie,!1,null,"d57856a8",null);const ae=oe.exports,le={name:"App",components:{PDFElements:_,AppToolbar:F,DocumentsList:Y,SignatureBox:U,DeleteButton:ee,ElementsViewer:ae},data(){return{initFiles:["https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf"],fileNames:["sample.pdf"],componentKey:0,loading:!1,pdfReady:!1,showElementsViewer:!1,isAddingElement:!1}},computed:{isReady(){return this.pdfReady&&!!this.$refs.pdf},pdf(){return this.$refs.pdf||null}},methods:{onReady(){this.loading=!1,this.pdfReady=!0},loadSample(){this.loading=!0,this.pdfReady=!1,this.initFiles=["https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf"],this.fileNames=["sample.pdf"],this.forceRenderDocuments()},onFilesChange(e){const t=Array.from(e.target.files||[]);0!==t.length&&(this.loading=!0,this.pdfReady=!1,this.initFiles=[...this.initFiles,...t],this.fileNames=[...this.fileNames,...t.map(e=>e.name)],this.forceRenderDocuments(),e.target.value="")},removeDocument(e){this.initFiles=this.initFiles.filter((t,i)=>i!==e),this.fileNames=this.fileNames.filter((t,i)=>i!==e),0===this.initFiles.length&&(this.pdfReady=!1),this.forceRenderDocuments()},clearAll(){confirm("Clear all documents and objects?")&&(this.initFiles=[],this.fileNames=[],this.pdfReady=!1,this.forceRenderDocuments())},forceRenderDocuments(){this.componentKey+=1},startAddingSignature(){const e=this.$refs.pdf;e&&(this.isAddingElement=!0,e.startAddingElement({width:160,height:48,type:"signature",label:"Signature",icon:"signature"}),this.$nextTick(()=>{const t=()=>{!1===e.isAddingMode&&this.isAddingElement?this.isAddingElement=!1:!0===e.isAddingMode&&requestAnimationFrame(t)};requestAnimationFrame(t)}))},getResponsiveFontSize(e){const t=6,i=14,s=160,n=48,o=Math.min(e.width/s,e.height/n),a=Math.sqrt(o),l=Math.max(t,Math.min(i,i*a));return`${l}px`},showObjects(){this.showElementsViewer=!0}}};s.Ay.config.productionTip=!1;const re=le;var de=(0,p.A)(re,n,o,!1,null,"11a3043c",null);const he=de.exports;s.Ay.config.productionTip=!1,new s.Ay({render:e=>e(he)}).$mount("#app")}},t={};function i(s){var n=t[s];if(void 0!==n)return n.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,i),o.exports}i.m=e,(()=>{var e=[];i.O=(t,s,n,o)=>{if(!s){var a=1/0;for(h=0;h<e.length;h++){for(var[s,n,o]=e[h],l=!0,r=0;r<s.length;r++)(!1&o||a>=o)&&Object.keys(i.O).every(e=>i.O[e](s[r]))?s.splice(r--,1):(l=!1,o<a&&(a=o));if(l){e.splice(h--,1);var d=n();void 0!==d&&(t=d)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[s,n,o]}})(),(()=>{i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}})(),(()=>{i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{i.p="/pdf-elements/"})(),(()=>{var e={57:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var n,o,[a,l,r]=s,d=0;if(a.some(t=>0!==e[t])){for(n in l)i.o(l,n)&&(i.m[n]=l[n]);if(r)var h=r(i)}for(t&&t(s);d<a.length;d++)o=a[d],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(h)},s=globalThis["webpackChunk_libresign_pdf_elements"]=globalThis["webpackChunk_libresign_pdf_elements"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var s=i.O(void 0,[504],()=>i(7938));s=i.O(s)})();
//# sourceMappingURL=index.4e29f1d9.js.map